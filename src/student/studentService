const studentModel = require('./studentModel');
const encryptor = require('simple-encryptor')('123456789trytryrtyr');

module.exports.createStudentDBService = (studentDetails) => {
   return new Promise((resolve, reject) => {
       const studentModelData = new studentModel({
           firstname: studentDetails.firstname,
           lastname: studentDetails.lastname,
           email: studentDetails.email,
           password: encryptor.encrypt(studentDetails.password)
       });

       studentModelData.save()
           .then(result => {
               resolve(true);
           })
           .catch(error => {
               reject(false);
           });
   });
}

module.exports.loginuserDBService = (studentDetails) => {
   return new Promise((resolve, reject) => {
       studentModel.findOne({ email: studentDetails.email })
           .then(result => {
               if (!result) {
                   reject({ status: false, msg: "Invalid Data" });
               } else {
                   const decrypted = encryptor.decrypt(result.password);
                   if (decrypted === studentDetails.password) {
                       resolve({ status: true, msg: "Student Validated Successfully" });
                   } else {
                       reject({ status: false, msg: "Student Validation failed" });
                   }
               }
           })
           .catch(error => {
               reject({ status: false, msg: "Student Error Details" });
           });
   });
}
